{% extends "layout.njk" %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set pageTitle = "Tasks" %}

{% block content %}
  {% include "includes/flash-banner.njk" %}

  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-2" style="margin-right: auto;">Tasks</h1>
    <a class="govuk-button" href="/tasks/new" data-module="govuk-button" style="margin-left: auto;">Create a task</a>
  </div>

  <p class="govuk-body">Manage simple case tasks: create, view, update status, and delete.</p>

  {% if tasks and tasks.length %}
    {% for t in tasks %}
      {% if t.status == "COMPLETED" or t.status == "DONE" %}
        {% set tagClass = "govuk-tag--green" %}
      {% elif t.status == "IN_PROGRESS" %}
        {% set tagClass = "govuk-tag--blue" %}
      {% else %}
        {% set tagClass = "govuk-tag--grey" %}
      {% endif %}
      <div class="govuk-!-margin-bottom-4"
           style="border:1px solid #505a5f; padding:16px; border-radius:6px;">
        {{ govukSummaryList({
          classes: "govuk-!-margin-bottom-0",
          rows: [
            { key: { text: "Title" },       value: { text: t.title } },
            { key: { text: "Case number" }, value: { text: t.caseNumber or "â€”" } },
            { key: { text: "Due" },         value: { text: t.displayDue } },
            { key: { text: "Status" },      value: { html: govukTag({ text: t.status, classes: tagClass }) } },
            { key: { text: "Actions" },     value: {
                html:
                  '<a class="govuk-link" href="/tasks/' ~ t.id ~ '">View</a>' ~
                  ' &nbsp;|&nbsp; ' ~
                  '<a class="govuk-link" href="/tasks/' ~ t.id ~ '/edit">Edit</a>' ~
                  ' &nbsp;|&nbsp; ' ~
                  '<a class="govuk-link" href="/tasks/' ~ t.id ~ '/delete">Delete</a>'
              }
            }
          ]
        }) }}
      </div>
    {% endfor %}
  {% else %}
    <p class="govuk-body">No tasks found.</p>
  {% endif %}
{% endblock %}